<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>4.8 Actividad agrícola en Sololá · EPC AALA</title>
  <meta name="description" content="Actividad agrícola en Sololá: calendario lunar, producción, café y organizaciones. Mapa mental + 4 juegos." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.16.1"></script>

  <style>
    :root{
      --ink:#0b1020;
      --muted:rgba(11,16,32,.72);
      --stroke:rgba(11,16,32,.10);
      --glass:rgba(255,255,255,.66);
      --shadow:0 18px 45px rgba(11,16,32,.14);
      --shadow-soft:0 10px 24px rgba(11,16,32,.10);
      --radius:24px;

      --a1: rgba(160, 220, 255, .95);
      --a2: rgba(190, 235, 255, .92);
      --a3: rgba(210, 245, 255, .88);

      --good: rgba(34,197,94,.16);
      --bad: rgba(225,29,72,.14);
      --warn: rgba(245,158,11,.14);
      --info: rgba(56,189,248,.16);

      --btn: rgba(255,255,255,.62);
      --btnh: rgba(255,255,255,.82);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 760px at 12% 12%, var(--a2), transparent 58%),
        radial-gradient(980px 760px at 84% 18%, var(--a1), transparent 62%),
        radial-gradient(1200px 920px at 48% 96%, var(--a3), transparent 58%),
        linear-gradient(135deg, #eefaff 0%, #e8f7ff 45%, #f2fcff 100%);
      min-height:100vh;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 64px;}
    header{
      border:1px solid var(--stroke);
      background:var(--glass);
      border-radius:var(--radius);
      box-shadow:var(--shadow-soft);
      backdrop-filter: blur(12px);
      padding:18px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }
    .kicker{
      display:inline-flex;gap:8px;align-items:center;
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.62);
      font-weight:900;font-size:12px;color:rgba(11,16,32,.78);
      box-shadow:var(--shadow-soft);
    }
    h1{
      margin:10px 0 0;
      font-family:Outfit,Inter,system-ui;
      font-weight:900;
      letter-spacing:.2px;
      line-height:1.08;
      font-size:clamp(22px, 2.7vw, 34px);
    }
    .subtitle{margin:8px 0 0;color:var(--muted);font-size:14px;line-height:1.55;max-width:95ch;}
    .nav{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .btn{
      appearance:none;border:1px solid rgba(11,16,32,.12);
      background:var(--btn);
      border-radius:14px;
      padding:10px 12px;
      text-decoration:none;
      font-weight:900;font-size:13px;
      color:rgba(11,16,32,.86);
      box-shadow:var(--shadow-soft);
      user-select:none;
      display:inline-flex;align-items:center;gap:8px;
      transition:transform .08s ease, background .12s ease, border-color .12s ease;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn:hover{background:var(--btnh);border-color:rgba(11,16,32,.18)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:rgba(120, 210, 255, .28);
      border-color:rgba(35, 140, 210, .22);
    }
    main.stack{display:flex;flex-direction:column;gap:14px;margin-top:14px;}
    .card{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.62);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      padding:16px;
    }
    .card h2{
      margin:0;
      font-family:Outfit,Inter,system-ui;
      font-weight:900;
      font-size:18px;
      letter-spacing:.2px;
    }
    .hint{margin:6px 0 0;color:rgba(11,16,32,.70);font-size:13px;line-height:1.5}
    .twoCols{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1.25fr .95fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width:980px){ .twoCols{grid-template-columns:1fr;} }
    .box{
      border:1px solid rgba(11,16,32,.10);
      background:rgba(255,255,255,.58);
      border-radius:18px;
      padding:12px;
      box-shadow:var(--shadow-soft);
    }
    .box p{margin:0 0 10px;color:rgba(11,16,32,.82);line-height:1.65;font-size:13.6px}
    .box ul{margin:8px 0 0 18px;color:rgba(11,16,32,.82);font-size:13.4px;line-height:1.6}
    .box li{margin:6px 0}
    .grid3{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width:980px){ .grid3{grid-template-columns:1fr;} }
    .pill{
      border:1px solid rgba(11,16,32,.10);
      background:linear-gradient(135deg, rgba(180,235,255,.55), rgba(255,255,255,.58));
      border-radius:18px;
      padding:12px;
      box-shadow:var(--shadow-soft);
    }
    .pill .t{font-weight:900;font-family:Outfit,Inter,system-ui;letter-spacing:.2px}
    .pill .s{margin:6px 0 0;color:rgba(11,16,32,.74);font-size:13px;line-height:1.5}
    .result{
      margin-top:10px;
      border-radius:16px;
      border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.55);
      padding:12px;
      font-size:13px;
      line-height:1.55;
      color:rgba(11,16,32,.82);
      display:none;
    }
    .result.show{display:block}
    .ok{background:var(--good);border-color:rgba(34,197,94,.28)}
    .no{background:var(--bad);border-color:rgba(225,29,72,.22)}
    .warn{background:var(--warn);border-color:rgba(245,158,11,.22)}
    .info{background:var(--info);border-color:rgba(56,189,248,.22)}

    /* Mapa mental */
    .mapTop{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap;}
    .mapBtns{display:flex;gap:10px;flex-wrap:wrap;}
    .mapStage{
      margin-top:10px;
      border-radius:18px;
      border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.60);
      box-shadow:var(--shadow-soft);
      overflow:hidden;
      padding:10px;
    }
    svg#mindmap{
      width:100%;
      height:520px;
      display:block;
      border-radius:14px;
      background:
        radial-gradient(700px 380px at 20% 0%, rgba(45,160,220,.10), transparent 55%),
        radial-gradient(700px 380px at 80% 10%, rgba(34,197,94,.10), transparent 55%);
    }
    .fallback{
      display:none;
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(11,16,32,.18);
      background:rgba(255,255,255,.55);
      color:rgba(11,16,32,.72);
      font-size:13px;
      line-height:1.5;
    }
    .fallback.show{display:block}

    /* Util */
    .mini{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(11,16,32,.10);
      background:rgba(255,255,255,.58);
      font-weight:900;font-size:12px;color:rgba(11,16,32,.78);
      box-shadow:var(--shadow-soft);
    }
    .hr{height:1px;background:rgba(11,16,32,.10);margin:10px 0;border-radius:999px}
    footer{text-align:center;padding:18px 0 4px;color:rgba(11,16,32,.58);font-size:13px}

    /* Game layouts */
    .gameGrid{margin-top:10px;display:grid;grid-template-columns:1.05fr .95fr;gap:12px;align-items:start}
    @media (max-width:980px){ .gameGrid{grid-template-columns:1fr;} }

    .palette{display:grid;grid-template-columns:repeat(2, 1fr);gap:10px}
    @media (max-width:520px){ .palette{grid-template-columns:1fr;} }

    .tile{
      border-radius:18px;border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.70);
      box-shadow:var(--shadow-soft);
      padding:10px;
      cursor:grab;
      user-select:none;
      transition:transform .08s ease, background .12s ease, border-color .12s ease;
    }
    .tile:hover{background:rgba(255,255,255,.84);border-color:rgba(11,16,32,.18)}
    .tile:active{transform:translateY(1px)}
    .tile .t{font-weight:900}
    .tile .s{margin-top:6px;color:rgba(11,16,32,.72);font-size:12.6px;line-height:1.4}
    .tile .tag{display:inline-flex;margin-top:8px;font-size:11px;font-weight:900;color:rgba(11,16,32,.74);padding:4px 8px;border-radius:999px;border:1px solid rgba(11,16,32,.10);background:rgba(255,255,255,.62)}

    .drop{
      border-radius:18px;border:1px dashed rgba(11,16,32,.18);
      background:rgba(255,255,255,.56);
      box-shadow:var(--shadow-soft);
      padding:12px;
      min-height: 220px;
    }
    .drop.dragover{outline:3px solid rgba(120,210,255,.35)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.72);
      font-weight:900;font-size:12px;color:rgba(11,16,32,.78);
    }
    .chip button{border:none;background:transparent;cursor:pointer;font:inherit;color:inherit;padding:0}

    .bars{display:grid;gap:10px;margin-top:10px}
    .bar{
      border-radius:16px;border:1px solid rgba(11,16,32,.10);
      background:rgba(255,255,255,.62);
      box-shadow:var(--shadow-soft);
      padding:10px;
    }
    .bar .k{font-size:12px;color:rgba(11,16,32,.70);font-weight:900}
    .bar .row{display:flex;align-items:center;gap:10px;margin-top:8px}
    .track{flex:1;height:12px;border-radius:999px;background:rgba(11,16,32,.10);overflow:hidden}
    .fill{height:100%;width:50%;background:rgba(45,160,220,.45);transition:width .2s ease}
    .bar .v{min-width:44px;text-align:right;font-weight:900;color:rgba(11,16,32,.78);font-size:12px}

    .qaGrid{margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start}
    @media (max-width:980px){ .qaGrid{grid-template-columns:1fr;} }

    .qCard{
      border-radius:18px;border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.62);
      box-shadow:var(--shadow-soft);
      padding:12px;
    }
    .qCard .q{font-weight:900;margin:0 0 8px}
    .opt{width:100%;text-align:left;margin:8px 0;padding:10px 12px;border-radius:16px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.70);cursor:pointer;font-weight:900;color:rgba(11,16,32,.86)}
    .opt:hover{background:rgba(255,255,255,.84);border-color:rgba(11,16,32,.18)}
    .opt:disabled{opacity:.9;cursor:default}
    .opt.good{background:rgba(34,197,94,.14);border-color:rgba(34,197,94,.26)}
    .opt.bad{background:rgba(225,29,72,.12);border-color:rgba(225,29,72,.22)}

    /* Small SVG scenes */
    .scene{
      border-radius:18px;border:1px solid rgba(11,16,32,.12);
      background:rgba(255,255,255,.60);
      box-shadow:var(--shadow-soft);
      padding:10px;
      overflow:hidden;
    }
    .ctrlRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px}
    .ctrlRow label{font-weight:900;font-size:13px;color:rgba(11,16,32,.82)}
    input[type="range"]{width:54%}
    .val{font-weight:900;font-size:13px;color:rgba(11,16,32,.78);min-width:64px;text-align:right}

  </style>

  <style>
    .moonRow{margin-top:10px;display:grid;grid-template-columns:1.05fr .95fr;gap:12px;align-items:start}
    @media (max-width:980px){.moonRow{grid-template-columns:1fr}}
    .moonChoices{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .phase{border-radius:18px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.72);box-shadow:var(--shadow-soft);padding:12px;cursor:pointer;user-select:none;transition:transform .08s ease, background .12s ease}
    .phase:hover{background:rgba(255,255,255,.84);transform:translateY(-1px)}
    .phase.good{background:rgba(34,197,94,.16);border-color:rgba(34,197,94,.28)}
    .phase.bad{background:rgba(225,29,72,.12);border-color:rgba(225,29,72,.22)}
    .phase .t{font-weight:900}
    .phase .s{margin-top:6px;color:rgba(11,16,32,.70);font-size:12.6px;line-height:1.4}

    .moonIcon{width:40px;height:40px;border-radius:999px;border:1px solid rgba(11,16,32,.12);background:rgba(11,16,32,.06);display:inline-flex;align-items:center;justify-content:center;margin-right:8px}
    .moonIcon svg{width:28px;height:28px}

    .statRow{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .tbl{margin-top:10px;border-radius:18px;border:1px solid rgba(11,16,32,.10);background:rgba(255,255,255,.60);box-shadow:var(--shadow-soft);overflow:hidden}
    .tbl table{width:100%;border-collapse:collapse}
    .tbl th,.tbl td{padding:10px 12px;border-bottom:1px solid rgba(11,16,32,.08);font-size:13px}
    .tbl th{text-align:left;font-weight:900;background:rgba(255,255,255,.55)}
    .tbl td input{width:84px;padding:8px 10px;border-radius:14px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.72);font-weight:900;color:rgba(11,16,32,.82)}

    .story{margin-top:10px;border-radius:18px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.60);box-shadow:var(--shadow-soft);padding:12px}
    .story h3{margin:0;font-family:Outfit,Inter,system-ui;font-weight:900;font-size:16px}
    .meter3{margin-top:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width:980px){.meter3{grid-template-columns:1fr}}
    .meter{border-radius:18px;border:1px solid rgba(11,16,32,.10);background:rgba(255,255,255,.68);box-shadow:var(--shadow-soft);padding:12px}
    .meter .k{font-weight:900;font-size:12.6px;color:rgba(11,16,32,.72)}
    .meter .big{margin-top:6px;font-family:Outfit,Inter,system-ui;font-weight:900;font-size:26px;line-height:1}
    .storyBtns{margin-top:10px;display:grid;gap:10px}
    .storyBtns .opt{margin:0}

    /* matching */
    .matchWrap{margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start}
    @media (max-width:980px){.matchWrap{grid-template-columns:1fr}}
    .matchCol{border-radius:18px;border:1px solid rgba(11,16,32,.10);background:rgba(255,255,255,.58);box-shadow:var(--shadow-soft);padding:12px}
    .mItem{border-radius:16px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.72);padding:10px 12px;margin:8px 0;cursor:pointer;user-select:none;font-weight:900;color:rgba(11,16,32,.84)}
    .mItem:hover{background:rgba(255,255,255,.84)}
    .mItem.sel{outline:3px solid rgba(120,210,255,.35)}
    .mItem.done{background:rgba(34,197,94,.16);border-color:rgba(34,197,94,.26);cursor:default}
    .pairList{margin-top:10px;display:grid;gap:8px}
    .pair{border-radius:16px;border:1px solid rgba(11,16,32,.12);background:rgba(255,255,255,.62);padding:10px 12px;font-weight:900;color:rgba(11,16,32,.82)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="kicker">Módulo 4 · El suelo</div>
        <h1>4.8 Actividad agrícola en Sololá</h1>
        <p class="subtitle">
          En Sololá, la agricultura combina prácticas ancestrales y producción moderna en un territorio de laderas.
          El manejo del suelo (cobertura, fertilidad, control de erosión) y el uso del conocimiento local —como el <strong>calendario lunar</strong>—
          influyen en rendimientos, estabilidad y sostenibilidad.
        </p>
      </div>
      <nav class="nav">
        <a class="btn" href="index.html">Inicio</a>
        <a class="btn" href="4-7.html">Anterior (4.7)</a>
        <a class="btn primary" href="4-9.html">Siguiente (4.9)</a>
      </nav>
    </header>

    <main class="stack">

      <!-- TEORÍA -->
      <section class="card">
        <h2>Contexto teórico (muy ampliado)</h2>
        <p class="hint">
          La actividad agrícola en Sololá está muy ligada a la identidad y a prácticas heredadas.
          En varias comunidades se toma en cuenta la relación con la naturaleza (permiso/agradecimiento),
          y se usan señales del entorno —incluida la luna— para planificar labores.
        </p>

        <div class="twoCols">
          <div class="box">
            <p><strong>Agricultura y cultura</strong></p>
            <p>
              En el territorio se reconocen prácticas ancestrales vinculadas a pueblos originarios.
              Además de la técnica, existe una dimensión de <strong>respeto</strong> y <strong>equilibrio</strong> con la naturaleza.
            </p>
            <ul>
              <li>Se planifican labores según señales (clima, suelo, ciclos, luna).</li>
              <li>Se prioriza cuidar el suelo porque en ladera la erosión puede ser rápida.</li>
              <li>La diversificación (cultivos y sistemas) puede reducir riesgos.</li>
            </ul>
            <div class="result info show">
              <strong>Idea clave:</strong> cuando el suelo se pierde, se pierde la “fábrica” que produce alimentos.
            </div>
          </div>

          <div class="box">
            <p><strong>Calendario lunar (ejemplo de uso agrícola)</strong></p>
            <p>
              Algunas prácticas locales asocian fases lunares con labores específicas.
              Esto funciona como un <strong>calendario</strong> que organiza trabajo y decisiones.
            </p>
            <ul>
              <li><strong>Luna llena:</strong> dejar caer tallos, ramas y frutos.</li>
              <li><strong>Cuarto creciente:</strong> sembrar, chapodar y cosechar.</li>
              <li><strong>Luna nueva:</strong> sembrar y cosechar.</li>
              <li><strong>Cuarto menguante:</strong> podar, rajar leña, chapodar.</li>
            </ul>
          </div>
        </div>

        <div class="grid3">
          <div class="pill">
            <div class="t">Producción (referencia)</div>
            <p class="s">Registros muestran producción anual en el orden de <strong>~1.78 millones de quintales</strong> (todas las actividades agrícolas).</p>
          </div>
          <div class="pill">
            <div class="t">Rubros principales</div>
            <p class="s">Café y banano destacan, junto con papa, maíz, cebolla, frijol y hortalizas (según registros agrícolas).</p>
          </div>
          <div class="pill">
            <div class="t">Café: economía y paisaje</div>
            <p class="s">La caficultura involucra muchos productores; se distinguen sistemas convencionales y orgánicos, con apoyo institucional.</p>
          </div>
        </div>

        <div class="twoCols" style="margin-top:12px;">
          <div class="box">
            <p><strong>Distribución de rubros (ejemplo de porcentaje)</strong></p>
            <p>Un ejemplo de distribución registrada (ilustrativa) incluye:</p>
            <ul>
              <li><strong>Café:</strong> 26.7%</li>
              <li><strong>Banano:</strong> 24.5%</li>
              <li><strong>Papa:</strong> 14.7%</li>
              <li><strong>Maíz:</strong> 14.1%</li>
              <li><strong>Cebolla:</strong> 6.1%</li>
              <li><strong>Frijol:</strong> 4.0%</li>
              <li><strong>Forestales:</strong> 4.1%</li>
              <li><strong>Hortalizas:</strong> 2.6%</li>
            </ul>
            <p style="margin-top:10px;">
              Estos porcentajes ayudan a entender qué cultivos dominan y cómo eso influye en mercado, uso de suelo y conservación.
            </p>
          </div>

          <div class="box">
            <p><strong>Café: organizaciones y enfoques</strong></p>
            <ul>
              <li><strong>Convencional:</strong> suele usar fertilización y control con insumos externos; requiere cuidado para no afectar suelo/agua.</li>
              <li><strong>Orgánico:</strong> busca reducir químicos, usar abonos orgánicos y fortalecer manejo ecológico.</li>
            </ul>
            <p style="margin-top:10px;">
              Existen organizaciones que apoyan capacitación, acompañamiento técnico y comercialización (por ejemplo,
              <strong>ANACAFÉ</strong> y asociaciones de productores).
            </p>
            <div class="result warn show">
              <strong>Reto en laderas:</strong> intensificar sin conservación aumenta erosión. La clave es combinar producción con prácticas de suelo.
            </div>
          </div>
        </div>
      </section>

      <!-- MAPA -->
      <section class="card">
        <div class="mapTop">
          <div>
            <h2>Mapa mental</h2>
            <div class="hint">Sololá: cultura agrícola · calendario lunar · rubros · café · retos en ladera.</div>
          </div>
          <div class="mapBtns">
            <button class="btn" id="fit" type="button">Ajustar</button>
            <button class="btn" id="toggle" type="button">Expandir/Contraer</button>
            <button class="btn" id="resetMap" type="button">Reiniciar</button>
          </div>
        </div>

        <div class="mapStage">
          <svg id="mindmap" class="markmap" role="img" aria-label="Mapa mental de actividad agrícola en Sololá"></svg>
          <div class="fallback" id="fallback">No se pudo cargar el mapa. Verifica conexión o recarga la página.</div>
        </div>
      </section>

      <!-- GAME 1: Lunar quiz -->
      <section class="card">
        <h2>Juego 1 · Quiz del calendario lunar</h2>
        <p class="hint">
          Selecciona la fase lunar que corresponde a la labor. (Basado en el ejemplo del módulo.)
        </p>

        <div class="moonRow">
          <div class="box">
            <p style="margin:0"><strong>Reto:</strong> <span id="moonTask">—</span></p>
            <div class="hint" id="moonHint">Presiona “Empezar” para recibir una tarea.</div>

            <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
              <button class="btn primary" id="moonStart" type="button">Empezar</button>
              <button class="btn" id="moonNext" type="button">Siguiente</button>
              <button class="btn" id="moonReset" type="button">Reiniciar</button>
              <span class="mini">Puntaje: <span id="moonScore">0</span>/<span id="moonTotal">0</span></span>
            </div>
            <div class="result info" id="moonMsg"></div>
          </div>

          <div class="box">
            <div class="moonChoices" id="moonChoices"></div>
            <div class="hint" style="margin-top:10px;">
              Consejo: algunas labores se asocian a más de una fase; aquí usamos la asociación principal del ejemplo.
            </div>
          </div>
        </div>
      </section>

      <!-- GAME 2: Production planner -->
      <section class="card">
        <h2>Juego 2 · Planificador de producción (ajusta porcentajes)</h2>
        <p class="hint">
          Intenta acercarte a la distribución de rubros del ejemplo (café, banano, papa, maíz, etc.). Ajusta valores y mira tu error total.
          Pista: el total debe ser <strong>100%</strong>.
        </p>

        <div class="twoCols">
          <div class="box">
            <div class="tbl">
              <table>
                <thead>
                  <tr><th>Rubro</th><th>Tu %</th><th>Referencia</th></tr>
                </thead>
                <tbody id="prodRows"></tbody>
              </table>
            </div>

            <div class="statRow">
              <button class="btn" type="button" id="normalize">Normalizar a 100%</button>
              <button class="btn" type="button" id="prodReset">Reiniciar</button>
              <span class="mini">Suma: <span id="sum">0</span>%</span>
            </div>

            <div class="result info" id="prodMsg"></div>
          </div>

          <div class="box">
            <p><strong>¿Cómo se evalúa?</strong></p>
            <ul>
              <li>Se calcula el <strong>error absoluto</strong> entre tu porcentaje y la referencia.</li>
              <li>Mientras menor sea el error, mejor tu puntaje.</li>
              <li>El objetivo es aprender a “leer” una estructura productiva.</li>
            </ul>

            <div class="result warn show">
              <strong>Recuerda:</strong> no es “adivinar perfecto”, es comprender qué rubros dominan y por qué eso importa para el suelo y el territorio.
            </div>
          </div>
        </div>
      </section>

      <!-- GAME 3: Coffee story -->
      <section class="card">
        <h2>Juego 3 · Café: ruta de decisiones (mini-aventura)</h2>
        <p class="hint">
          Toma decisiones de manejo. Tu objetivo: buena <strong>calidad</strong> sin perder <strong>suelo</strong> y sin disparar <strong>costos</strong>.
        </p>

        <div class="story">
          <h3 id="stTitle">Paso 1</h3>
          <div class="hint" id="stText">Presiona “Iniciar” para comenzar.</div>

          <div class="meter3">
            <div class="meter"><div class="k">Calidad</div><div class="big"><span id="mQ">50</span>/100</div></div>
            <div class="meter"><div class="k">Suelo</div><div class="big"><span id="mS">50</span>/100</div></div>
            <div class="meter"><div class="k">Costo</div><div class="big"><span id="mC">50</span>/100</div></div>
          </div>

          <div class="storyBtns" id="stOpts"></div>

          <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
            <button class="btn primary" id="stStart" type="button">Iniciar</button>
            <button class="btn" id="stReset" type="button">Reiniciar</button>
            <span class="mini">Progreso: <span id="stStep">0</span>/<span id="stTotal">0</span></span>
          </div>

          <div class="result info" id="stMsg"></div>
        </div>
      </section>

      <!-- GAME 4: Matching organizations -->
      <section class="card">
        <h2>Juego 4 · Conecta organización ↔ función</h2>
        <p class="hint">
          Haz clic en una organización (izquierda) y luego en una función (derecha) para crear una pareja.
          Cuando completes todas, presiona “Verificar”.
        </p>

        <div class="matchWrap">
          <div class="matchCol">
            <strong>Organizaciones</strong>
            <div id="orgCol"></div>
          </div>
          <div class="matchCol">
            <strong>Funciones</strong>
            <div id="funCol"></div>
          </div>
        </div>

        <div class="twoCols" style="margin-top:12px;">
          <div class="box">
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
              <button class="btn" id="chkMatch" type="button">Verificar</button>
              <button class="btn" id="resetMatch" type="button">Reiniciar</button>
              <span class="mini">Parejas: <span id="matchN">0</span>/<span id="matchT">0</span></span>
            </div>
            <div class="pairList" id="pairList"></div>
            <div class="result info" id="matchMsg"></div>
          </div>

          <div class="box">
            <p><strong>¿Para qué sirve este juego?</strong></p>
            <ul>
              <li>Reconocer actores que apoyan producción y conservación.</li>
              <li>Entender que el suelo también se cuida con organización: capacitación, comercialización y acuerdos.</li>
              <li>Relacionar producción con sostenibilidad (convencional vs orgánico).</li>
            </ul>
          </div>
        </div>
      </section>

      <footer>EPC AALA</footer>
    </main>
  </div>

  <script>
    // =========================
    // MAPA (Markmap)
    // =========================
    const md = '# 4.8 Actividad agrícola en Sololá\n## Rasgos generales\n- Agricultura con raíces **ancestrales** (pueblos originarios)\n- Se considera la relación con la naturaleza: permiso, agradecimiento, respeto\n- El suelo y el clima de ladera obligan a cuidar erosión y fertilidad\n## Calendario lunar (ejemplo)\n- Luna llena: dejar caer tallos, ramas y frutos\n- Cuarto creciente: sembrar, chapodar y cosechar\n- Luna nueva: sembrar y cosechar\n- Cuarto menguante: podar, rajar leña, chapodar\n## Producción (idea del registro)\n- Producción total anual (referencia): ~1.78 millones de quintales\n- Principales rubros: café, banano, papa, maíz, cebolla, frijol, hortalizas\n## Café (importancia)\n- Muchos productores a pequeña escala\n- Dos enfoques: convencional vs orgánico\n- Organizaciones apoyan técnica y comercialización (p. ej. ANACAFÉ, asociaciones locales)\n## Retos y oportunidades\n- Pendiente → riesgo de erosión\n- Manejo de fertilidad y agua\n- Diversificación y prácticas sostenibles';

    let mm=null, expanded=true;
    function renderMap(){
      const fb=document.getElementById('fallback');
      try{
        if(!window.markmap?.Transformer || !window.markmap?.Markmap) return false;
        const { Transformer, Markmap } = window.markmap;
        const t = new Transformer();
        const { root } = t.transform(md);
        const svg = document.getElementById('mindmap');
        while (svg.firstChild) svg.removeChild(svg.firstChild);
        mm = Markmap.create(svg, { autoFit:true, duration:240 }, root);
        fb.classList.remove('show');
        return true;
      }catch(e){
        fb.classList.add('show');
        return true;
      }
    }
    let tries=0; const it=setInterval(()=>{ tries++; const ok=renderMap(); if(ok||tries>12) clearInterval(it); }, 300);
    document.getElementById('fit').onclick=()=>mm&&mm.fit();
    document.getElementById('toggle').onclick=()=>{ if(!mm) return; expanded ? mm.foldAll() : mm.unfoldAll(); expanded=!expanded; };
    document.getElementById('resetMap').onclick=()=>{ mm=null; expanded=true; renderMap(); };

    const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
    function setBox(el, cls, html){ el.className="result "+cls+" show"; el.innerHTML=html; }

    // =========================
    // GAME 1: Moon quiz
    // =========================
    const PHASES = [
      {id:"llena", name:"Luna llena", svg:`<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(11,16,32,.75)"/></svg>`},
      {id:"creciente", name:"Cuarto creciente", svg:`<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(11,16,32,.16)"/><path d="M12 3a9 9 0 0 1 0 18z" fill="rgba(11,16,32,.75)"/></svg>`},
      {id:"nueva", name:"Luna nueva", svg:`<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(11,16,32,.16)"/></svg>`},
      {id:"menguante", name:"Cuarto menguante", svg:`<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="rgba(11,16,32,.16)"/><path d="M12 3a9 9 0 0 0 0 18z" fill="rgba(11,16,32,.75)"/></svg>`}
    ];

    const MOON_Q = [
      {task:"Podar", hint:"Poda y trabajo con madera se asocian a menguante.", a:"menguante"},
      {task:"Rajar leña", hint:"En el ejemplo: rajar leña en cuarto menguante.", a:"menguante"},
      {task:"Dejar caer tallos, ramas y frutos", hint:"En el ejemplo, esto se relaciona con luna llena.", a:"llena"},
      {task:"Sembrar + cosechar (paquete)", hint:"En el ejemplo, luna nueva se asocia a sembrar y cosechar.", a:"nueva"},
      {task:"Sembrar (en cuarto creciente)", hint:"El ejemplo menciona siembra en cuarto creciente.", a:"creciente"},
      {task:"Chapodar (paquete creciente)", hint:"En el ejemplo, chapodar aparece en cuarto creciente.", a:"creciente"},
      {task:"Cosechar (paquete creciente)", hint:"En el ejemplo, cosecha también se menciona con cuarto creciente.", a:"creciente"},
      {task:"Chapodar (paquete menguante)", hint:"El ejemplo también relaciona chapodar con cuarto menguante.", a:"menguante"}
    ];

    const moonTask=document.getElementById('moonTask');
    const moonHint=document.getElementById('moonHint');
    const moonChoices=document.getElementById('moonChoices');
    const moonMsg=document.getElementById('moonMsg');
    const moonScore=document.getElementById('moonScore');
    const moonTotal=document.getElementById('moonTotal');
    moonTotal.textContent = String(MOON_Q.length);

    let mi=-1, ms=0, lock=false;

    function renderMoonChoices(){
      moonChoices.innerHTML="";
      PHASES.forEach(p=>{
        const b=document.createElement('div');
        b.className="phase";
        b.dataset.id=p.id;
        b.innerHTML = `<div class="t"><span class="moonIcon">${p.svg}</span>${p.name}</div><div class="s">Seleccionar</div>`;
        b.onclick=()=>choosePhase(p.id, b);
        moonChoices.appendChild(b);
      });
    }

    function showMoonQ(){
      lock=false;
      document.querySelectorAll('.phase').forEach(x=>x.classList.remove('good','bad'));
      if(mi<0 || mi>=MOON_Q.length) return;
      const q=MOON_Q[mi];
      moonTask.textContent = q.task;
      moonHint.textContent = q.hint;
      setBox(moonMsg, "info", "Elige una fase.");
    }

    function choosePhase(id, el){
      if(lock || mi<0) return;
      lock=true;
      const q=MOON_Q[mi];
      if(id===q.a){
        ms++; el.classList.add('good');
        setBox(moonMsg, "ok", "✅ Correcto.");
      } else {
        el.classList.add('bad');
        document.querySelector(`.phase[data-id="${q.a}"]`)?.classList.add('good');
        setBox(moonMsg, "no", `❌ No. La asociación del ejemplo es: <strong>${PHASES.find(p=>p.id===q.a).name}</strong>.`);
      }
      moonScore.textContent = String(ms);
    }

    function moonStart(){
      ms=0; mi=0;
      moonScore.textContent="0";
      renderMoonChoices();
      showMoonQ();
    }
    function moonNext(){
      if(mi<0) return;
      mi++;
      if(mi>=MOON_Q.length){
        const cls = ms>=7 ? "ok" : ms>=5 ? "info" : "warn";
        setBox(moonMsg, cls, `Fin. Puntaje: <strong>${ms}/${MOON_Q.length}</strong>. ` + (cls==="ok" ? "¡Excelente!" : "Vuelve a intentarlo para afinar el calendario."));
        moonTask.textContent="—";
        moonHint.textContent="—";
        lock=true;
        return;
      }
      showMoonQ();
    }
    function moonReset(){
      mi=-1; ms=0; lock=false;
      moonScore.textContent="0";
      moonTask.textContent="—";
      moonHint.textContent="Presiona “Empezar”.";
      moonChoices.innerHTML="";
      moonMsg.classList.remove('show');
    }

    document.getElementById('moonStart').onclick=moonStart;
    document.getElementById('moonNext').onclick=moonNext;
    document.getElementById('moonReset').onclick=moonReset;
    moonReset();

    // =========================
    // GAME 2: Production planner
    // =========================
    const REF = [
      {k:"Café", v:26.7},
      {k:"Banano", v:24.5},
      {k:"Papa", v:14.7},
      {k:"Maíz", v:14.1},
      {k:"Cebolla", v:6.1},
      {k:"Frijol", v:4.0},
      {k:"Forestales", v:4.1},
      {k:"Hortalizas", v:2.6}
    ];

    const prodRows=document.getElementById('prodRows');
    const sumEl=document.getElementById('sum');
    const prodMsg=document.getElementById('prodMsg');

    function renderProd(){
      prodRows.innerHTML="";
      REF.forEach((r, idx)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td><strong>${r.k}</strong></td>
          <td><input type="number" min="0" max="100" step="0.1" id="p${idx}" value="${Math.round(r.v)}"></td>
          <td>${r.v}%</td>
        `;
        prodRows.appendChild(tr);
      });
      updateProd();
      setBox(prodMsg,"info","Ajusta valores y busca que sumen 100%.");
    }

    function updateProd(){
      let sum=0;
      REF.forEach((r, idx)=>{ sum += (+document.getElementById(`p${idx}`).value || 0); });
      sum = Math.round(sum*10)/10;
      sumEl.textContent = sum;
      const err = totalError();
      const score = clamp(Math.round(100 - err*1.2), 0, 100);

      if(sum!==100){
        setBox(prodMsg, sum>100 ? "warn" : "info", `Suma actual: <strong>${sum}%</strong>. Ajusta para llegar a 100%. Error total: <strong>${err.toFixed(1)}</strong>. Puntaje: <strong>${score}</strong>/100.`);
      } else {
        const cls = score>=85 ? "ok" : score>=70 ? "info" : "warn";
        setBox(prodMsg, cls, `✅ Suma 100%. Error total: <strong>${err.toFixed(1)}</strong>. Puntaje: <strong>${score}</strong>/100. ` +
          (cls==="ok" ? "¡Muy cerca de la referencia!" : "Puedes afinar un poco más: mira cuáles rubros están lejos."));
      }
    }

    function totalError(){
      let err=0;
      REF.forEach((r, idx)=>{
        const v=(+document.getElementById(`p${idx}`).value || 0);
        err += Math.abs(v - r.v);
      });
      return err;
    }

    function normalize(){
      let vals = REF.map((r, idx)=> (+document.getElementById(`p${idx}`).value || 0));
      let sum = vals.reduce((a,b)=>a+b,0);
      if(sum<=0) return;
      vals = vals.map(v=> (v/sum)*100);
      vals.forEach((v, idx)=>{ document.getElementById(`p${idx}`).value = (Math.round(v*10)/10).toFixed(1); });
      updateProd();
    }

    document.getElementById('normalize').onclick=normalize;
    document.getElementById('prodReset').onclick=renderProd;
    prodRows.addEventListener('input', (e)=>{ if(e.target.tagName==="INPUT") updateProd(); });
    renderProd();

    // =========================
    // GAME 3: Coffee story
    // =========================
    const STEPS = [
      {
        title:"Paso 1 · Sombra y biodiversidad",
        text:"Elige el sistema de sombra para tu cafetal.",
        opts:[
          {t:"Café bajo sombra con árboles diversos", d:{Q:+6,S:+10,C:+5}, note:"Mejora microclima y suelo."},
          {t:"Sombra mínima (pocos árboles)", d:{Q:+4,S:+2,C:+2}, note:"Más sol; más estrés hídrico."},
          {t:"Sin sombra (pleno sol)", d:{Q:+2,S:-6,C:+0}, note:"Riesgo de erosión y estrés."}
        ]
      },
      {
        title:"Paso 2 · Cobertura del suelo",
        text:"¿Cómo manejas el suelo entre plantas?",
        opts:[
          {t:"Mulch + cobertura viva", d:{Q:+3,S:+10,C:+4}, note:"Protege y alimenta el suelo."},
          {t:"Suelo limpio con machete (sin cobertura)", d:{Q:+2,S:-6,C:+2}, note:"Sube erosión en lluvia."},
          {t:"Quema de rastrojo", d:{Q:-2,S:-14,C:+0}, note:"Pierde materia orgánica."}
        ]
      },
      {
        title:"Paso 3 · Fertilidad",
        text:"Selecciona la estrategia principal de fertilización.",
        opts:[
          {t:"Compost / abono orgánico", d:{Q:+4,S:+10,C:+4}, note:"Aporta materia orgánica."},
          {t:"Mixto (orgánico + poco químico)", d:{Q:+5,S:+4,C:+6}, note:"Balance si se maneja bien."},
          {t:"Solo químico y frecuente", d:{Q:+6,S:-6,C:+8}, note:"Riesgo si se exagera."}
        ]
      },
      {
        title:"Paso 4 · Manejo de plagas",
        text:"¿Cómo controlas plagas/enfermedades?",
        opts:[
          {t:"Manejo integrado (monitoreo + control biológico)", d:{Q:+6,S:+4,C:+4}, note:"Prevención y equilibrio."},
          {t:"Aplicación química sistemática", d:{Q:+4,S:-4,C:+8}, note:"Control rápido, más costo."},
          {t:"No hacer nada", d:{Q:-6,S:+0,C:+0}, note:"Riesgo de pérdidas."}
        ]
      },
      {
        title:"Paso 5 · Cosecha y calidad",
        text:"Decide cómo cosechas para asegurar calidad.",
        opts:[
          {t:"Cosecha selectiva (solo maduro) + buen secado", d:{Q:+10,S:+0,C:+6}, note:"Sube calidad."},
          {t:"Cosecha rápida (mezclada)", d:{Q:-4,S:+0,C:+2}, note:"Baja calidad."},
          {t:"Cosecha selectiva + compostaje de pulpa", d:{Q:+8,S:+6,C:+5}, note:"Cierra ciclo de nutrientes."}
        ]
      }
    ];

    const stTitle=document.getElementById('stTitle');
    const stText=document.getElementById('stText');
    const stOpts=document.getElementById('stOpts');
    const stStart=document.getElementById('stStart');
    const stReset=document.getElementById('stReset');
    const stStep=document.getElementById('stStep');
    const stTotal=document.getElementById('stTotal');
    const stMsg=document.getElementById('stMsg');

    const mQ=document.getElementById('mQ');
    const mS=document.getElementById('mS');
    const mC=document.getElementById('mC');

    stTotal.textContent = String(STEPS.length);

    let si=-1;
    let meters={Q:50,S:50,C:50};

    function apply(d){ meters.Q=clamp(meters.Q+d.Q,0,100); meters.S=clamp(meters.S+d.S,0,100); meters.C=clamp(meters.C+d.C,0,100); }
    function renderMeters(){ mQ.textContent=meters.Q; mS.textContent=meters.S; mC.textContent=meters.C; }

    function showStep(){
      if(si<0 || si>=STEPS.length) return;
      const step=STEPS[si];
      stTitle.textContent = step.title;
      stText.textContent = step.text;
      stOpts.innerHTML="";
      step.opts.forEach(o=>{
        const b=document.createElement('button');
        b.type="button";
        b.className="opt";
        b.textContent=o.t;
        b.onclick = ()=> {
          apply(o.d);
          renderMeters();
          setBox(stMsg,"info", o.note);
          si++;
          stStep.textContent = String(Math.min(si, STEPS.length));
          if(si>=STEPS.length) endStory();
          else showStep();
        };
        stOpts.appendChild(b);
      });
    }

    function endStory(){
      stOpts.innerHTML="";
      const soilOk = meters.S>=70;
      const qualOk = meters.Q>=70;
      const costOk = meters.C<=75;

      let cls="info";
      if(soilOk && qualOk && costOk) cls="ok";
      else if(!soilOk || !qualOk) cls="warn";

      const msg = `<strong>Resultado:</strong> Calidad ${meters.Q}/100 · Suelo ${meters.S}/100 · Costo ${meters.C}/100.<br>` +
        (cls==="ok" ? "¡Excelente! Buen manejo con equilibrio." :
         cls==="warn" ? "Riesgo: mejora conservación de suelo y/o calidad." :
         "Bien, pero puedes ajustar para cuidar más el suelo o bajar costos.");

      setBox(stMsg, cls, msg);
    }

    function startStory(){
      si=0;
      meters={Q:50,S:50,C:50};
      renderMeters();
      stStep.textContent="0";
      setBox(stMsg,"info","Elige tu primera decisión.");
      showStep();
    }

    function resetStory(){
      si=-1;
      meters={Q:50,S:50,C:50};
      renderMeters();
      stStep.textContent="0";
      stTitle.textContent="Paso 1";
      stText.textContent="Presiona “Iniciar” para comenzar.";
      stOpts.innerHTML="";
      stMsg.classList.remove('show');
    }

    stStart.onclick = startStory;
    stReset.onclick = resetStory;
    resetStory();

    // =========================
    // GAME 4: Matching
    // =========================
    const ORGS = [
      {id:"anacafe", t:"ANACAFÉ"},
      {id:"fedepma", t:"FEDEPMA"},
      {id:"apocs", t:"APOCS"}
    ];
    const FUNS = [
      {id:"tecnica", t:"Asistencia técnica y promoción del café"},
      {id:"organiza", t:"Federación / articulación de productores"},
      {id:"organico", t:"Producción y comercialización orgánica local"}
    ];
    const ANSW = {
      anacafe:"tecnica",
      fedepma:"organiza",
      apocs:"organico"
    };

    const orgCol=document.getElementById('orgCol');
    const funCol=document.getElementById('funCol');
    const pairList=document.getElementById('pairList');
    const matchMsg=document.getElementById('matchMsg');
    const matchN=document.getElementById('matchN');
    const matchT=document.getElementById('matchT');
    matchT.textContent = String(ORGS.length);

    let selOrg=null, selFun=null;
    const pairs = new Map(); // org -> fun

    function renderMatch(){
      orgCol.innerHTML=""; funCol.innerHTML=""; pairList.innerHTML="";
      pairs.clear();
      selOrg=null; selFun=null;
      matchN.textContent="0";
      matchMsg.classList.remove('show');

      ORGS.forEach(o=>{
        const d=document.createElement('div');
        d.className="mItem";
        d.textContent=o.t;
        d.dataset.id=o.id;
        d.onclick=()=>selectOrg(d);
        orgCol.appendChild(d);
      });
      FUNS.forEach(f=>{
        const d=document.createElement('div');
        d.className="mItem";
        d.textContent=f.t;
        d.dataset.id=f.id;
        d.onclick=()=>selectFun(d);
        funCol.appendChild(d);
      });
      setBox(matchMsg,"info","Crea parejas: organización → función.");
    }

    function selectOrg(el){
      if(el.classList.contains('done')) return;
      document.querySelectorAll('#orgCol .mItem').forEach(x=>x.classList.remove('sel'));
      el.classList.add('sel');
      selOrg = el.dataset.id;
      tryPair();
    }
    function selectFun(el){
      if(el.classList.contains('done')) return;
      document.querySelectorAll('#funCol .mItem').forEach(x=>x.classList.remove('sel'));
      el.classList.add('sel');
      selFun = el.dataset.id;
      tryPair();
    }
    function tryPair(){
      if(!selOrg || !selFun) return;
      // add pair
      pairs.set(selOrg, selFun);
      // mark org done
      const oEl = document.querySelector(`#orgCol .mItem[data-id="${selOrg}"]`);
      const fEl = document.querySelector(`#funCol .mItem[data-id="${selFun}"]`);
      if(oEl){ oEl.classList.remove('sel'); oEl.classList.add('done'); }
      if(fEl){ fEl.classList.remove('sel'); fEl.classList.add('done'); }

      // list
      const orgT = ORGS.find(o=>o.id===selOrg).t;
      const funT = FUNS.find(f=>f.id===selFun).t;
      const p=document.createElement('div');
      p.className="pair";
      p.textContent = `${orgT} → ${funT}`;
      pairList.appendChild(p);

      selOrg=null; selFun=null;
      matchN.textContent = String(pairs.size);
      if(pairs.size===ORGS.length) setBox(matchMsg,"info","Listo. Presiona <strong>Verificar</strong>.");
    }

    function checkMatch(){
      if(pairs.size<ORGS.length){
        setBox(matchMsg,"warn",`Faltan parejas: <strong>${ORGS.length - pairs.size}</strong>.`);
        return;
      }
      let ok=0;
      ORGS.forEach(o=>{ if(pairs.get(o.id)===ANSW[o.id]) ok++; });
      if(ok===ORGS.length) setBox(matchMsg,"ok","¡Perfecto! Reconociste organización y función.");
      else setBox(matchMsg,"warn",`Aciertos: <strong>${ok}/${ORGS.length}</strong>. Reinicia e intenta de nuevo.`);
    }

    document.getElementById('chkMatch').onclick=checkMatch;
    document.getElementById('resetMatch').onclick=renderMatch;
    renderMatch();
  </script>
</body>
</html>