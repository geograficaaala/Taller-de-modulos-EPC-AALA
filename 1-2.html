<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Módulo 1 · 1.2 Cadenas alimenticias o tróficas</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Markmap -->
  <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.16.1"></script>

  <style>
    :root{
      --ink:#0b1020;
      --muted:rgba(11,16,32,.72);
      --glass:rgba(255,255,255,.66);
      --glass2:rgba(255,255,255,.52);
      --stroke:rgba(11,16,32,.10);
      --shadow:0 18px 45px rgba(11,16,32,.16);
      --shadow-soft:0 10px 24px rgba(11,16,32,.12);
      --radius:24px;

      --good: rgba(30, 160, 90, .20);
      --bad: rgba(210, 70, 100, .18);
      --focus: rgba(45, 160, 220, .28);
      --focus2: rgba(255, 140, 200, .22);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 760px at 12% 12%, rgba(175, 255, 216, .88), transparent 58%),
        radial-gradient(980px 760px at 82% 18%, rgba(170, 226, 255, .88), transparent 62%),
        radial-gradient(1200px 920px at 48% 96%, rgba(255, 191, 228, .76), transparent 58%),
        linear-gradient(135deg, #eafff4 0%, #e8f6ff 45%, #fff0f7 100%);
      min-height:100vh;
    }
    .wrap{ max-width: 1200px; margin: 0 auto; padding: 26px 18px 64px; }

    header{
      border: 1px solid var(--stroke);
      background: var(--glass);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(12px);
      padding: 16px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
      flex-wrap:wrap;
    }
    .kicker{ font-size: 12px; color: var(--muted); font-weight: 800; letter-spacing:.3px; }
    h1{
      margin: 6px 0 0;
      font-family: Outfit, Inter, system-ui;
      font-weight: 800;
      font-size: clamp(20px, 2.5vw, 28px);
      line-height: 1.15;
      letter-spacing:.2px;
    }
    .subtitle{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
      max-width: 88ch;
    }
    .nav{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.62);
      color: rgba(11,16,32,.92);
      font-weight: 800;
      text-decoration:none;
      font-size: 13px;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      cursor:pointer;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.80); border-color: rgba(11,16,32,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(170,255,216,.90), rgba(170,226,255,.90), rgba(255,191,228,.82));
    }

    .stack{ margin-top: 14px; display:grid; gap: 14px; }
    .card{
      border:1px solid var(--stroke);
      background: var(--glass);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      padding: 16px;
    }
    .card h2{
      margin:0;
      font-family: Outfit, Inter, system-ui;
      font-weight: 800;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .muted{ color: var(--muted); }

    .twoCols{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:start;
    }
    @media (max-width: 980px){ .twoCols{ grid-template-columns: 1fr; } }

    .theory{ line-height: 1.58; color: rgba(11,16,32,.90); font-size: 14px; }
    .theory p{ margin: 10px 0 0; }
    .theory ul{ margin: 10px 0 0 18px; }
    .theory li{ margin: 8px 0; }

    .callout{
      margin-top: 12px;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(11,16,32,.10);
      background: rgba(255,255,255,.55);
      color: rgba(11,16,32,.86);
      font-size: 13px;
      line-height: 1.45;
    }

    /* MAPA MARKMAP */
    .mapWrap{
      width:100%;
      height: 640px;
      margin-top: 10px;
      border: 1px solid rgba(11,16,32,.12);
      border-radius: 16px;
      overflow:hidden;
      background:
        radial-gradient(circle at 1px 1px, rgba(11,16,32,.08) 1px, transparent 1px) 0 0 / 22px 22px,
        rgba(255,255,255,.35);
      position: relative;
    }
    .mapWrap.tall{ height: 720px; }
    svg.markmap{ width:100%; height:100%; }
    .mapFallback{
      position:absolute; inset: 0;
      display:none; align-items:center; justify-content:center;
      text-align:center; padding: 18px;
      color: rgba(11,16,32,.75);
      background: rgba(255,255,255,.55);
    }
    .mapFallback.show{ display:flex; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; align-items:center; }
    .badge{
      display:inline-flex; align-items:center;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.55);
      font-weight: 800; font-size: 12px;
      color: rgba(11,16,32,.78);
    }

    /* MODAL FULLSCREEN (para cada mapa) */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(11,16,32,.35);
      backdrop-filter: blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 1000;
    }
    .modal.open{ display:flex; }
    .modalBox{
      width: min(1200px, 96vw);
      height: min(840px, 92vh);
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(11,16,32,.14);
      box-shadow: 0 30px 80px rgba(11,16,32,.30);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .modalTop{
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(11,16,32,.10);
      background: rgba(255,255,255,.70);
    }
    .modalTop strong{
      font-family: Outfit, Inter, system-ui;
      letter-spacing:.2px;
    }
    .modalMap{
      flex:1;
      background:
        radial-gradient(circle at 1px 1px, rgba(11,16,32,.08) 1px, transparent 1px) 0 0 / 22px 22px,
        rgba(255,255,255,.35);
    }
    .modalMap svg{ width:100%; height:100%; }

    /* CADENA TRÓFICA (SVG) */
    .chainWrap{
      width:100%;
      margin-top: 10px;
      border: 1px solid rgba(11,16,32,.12);
      border-radius: 16px;
      background: rgba(255,255,255,.45);
      overflow:hidden;
      position: relative;
      padding: 12px;
    }
    .chainHeader{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .chainHeader .muted{ font-size: 12px; }
    .svgBox{
      width:100%;
      height: 330px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 1px 1px, rgba(11,16,32,.07) 1px, transparent 1px) 0 0 / 22px 22px,
        rgba(255,255,255,.35);
      border: 1px solid rgba(11,16,32,.10);
      overflow:hidden;
    }
    @media (max-width: 720px){
      .svgBox{ height: 430px; }
    }
    .chainSvg{ width:100%; height:100%; }
    .node{
      cursor:pointer;
    }
    .node rect{
      fill: rgba(255,255,255,.78);
      stroke: rgba(11,16,32,.18);
      stroke-width: 1;
    }
    .node text{
      font-family: Inter, system-ui;
      font-size: 13px;
      font-weight: 800;
      fill: rgba(11,16,32,.90);
    }
    .node .sub{
      font-size: 11px;
      font-weight: 600;
      fill: rgba(11,16,32,.70);
    }
    .arrow{
      stroke: rgba(11,16,32,.65);
      stroke-width: 2.2;
      fill: none;
      marker-end: url(#arrowHead);
      opacity: .95;
    }
    .arrow.dim{ opacity: .25; }
    .arrow.active{ opacity: 1; stroke-width: 3.1; }
    .node.active rect{
      stroke-width: 2.5;
      stroke: rgba(45, 160, 220, .85);
    }
    .node.active text{ fill: rgba(11,16,32,.96); }

    .infoBox{
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.55);
      padding: 12px;
      font-size: 13px;
      line-height: 1.45;
      color: rgba(11,16,32,.86);
    }

    /* MINI-JUEGO: construir una cadena (drag/tap) */
    .gameGrid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 12px;
      align-items:start;
    }
    @media (max-width: 980px){ .gameGrid{ grid-template-columns: 1fr; } }

    .bank{
      border-radius: 18px;
      border: 1px solid rgba(11,16,32,.10);
      background: rgba(255,255,255,.55);
      padding: 12px;
      box-shadow: var(--shadow-soft);
    }
    .bank h3{
      margin: 0 0 8px;
      font-family: Outfit, Inter, system-ui;
      font-weight: 800;
      font-size: 14px;
    }

    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      min-height: 40px;
    }
    .chip{
      padding: 9px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.78);
      font-weight: 800;
      font-size: 13px;
      cursor: grab;
      user-select:none;
      transition: outline .08s ease, transform .08s ease;
    }
    .chip:active{ cursor: grabbing; transform: translateY(1px); }
    .chip.selected{ outline: 3px solid var(--focus2); }

    .slots{
      border-radius: 18px;
      border: 1px solid rgba(11,16,32,.10);
      background: rgba(255,255,255,.55);
      padding: 12px;
      box-shadow: var(--shadow-soft);
    }
    .slot{
      border-radius: 16px;
      border: 1px dashed rgba(11,16,32,.22);
      background: rgba(255,255,255,.45);
      padding: 10px;
      margin-top: 10px;
      min-height: 64px;
    }
    .slot:first-child{ margin-top: 0; }
    .slot.dragover{
      outline: 3px solid var(--focus);
      background: rgba(255,255,255,.62);
    }
    .slotHead{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .slotHead strong{
      font-family: Outfit, Inter, system-ui;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .slotHead span{
      color: var(--muted);
      font-size: 12px;
    }

    .small{ font-size: 12px; color: var(--muted); line-height: 1.4; margin-top: 8px; }
    .divider{ border:none; border-top: 1px solid rgba(11,16,32,.10); margin: 14px 0; }
    .result{
      margin-top: 12px;
      border-radius: 16px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.55);
      padding: 12px;
      font-size: 13px;
      line-height: 1.45;
      color: rgba(11,16,32,.86);
    }
    .ok{ background: var(--good); border-color: rgba(30,160,90,.28); }
    .no{ background: var(--bad); border-color: rgba(210,70,100,.26); }

    /* Helpers */
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.58);
      font-weight: 800;
      font-size: 12px;
      color: rgba(11,16,32,.78);
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="kicker">Módulo 1 · Medio ambiente</div>
        <h1>1.2 Las cadenas alimenticias o tróficas</h1>
        <p class="subtitle">
          Una cadena alimenticia (o red trófica) representa cómo los <strong>elementos bióticos</strong> dependen unos de otros y permite comprender
          el funcionamiento de la naturaleza para proteger la biodiversidad. :contentReference[oaicite:0]{index=0}
          El libro distingue <strong>productores</strong> (plantas, algas, fitoplancton) :contentReference[oaicite:1]{index=1},
          <strong>consumidores</strong> con niveles (primario → secundario → terciario → cuaternario) :contentReference[oaicite:2]{index=2}
          y <strong>descomponedores</strong> que reciclan nutrientes :contentReference[oaicite:3]{index=3}.
          En Sololá, esto se observa tanto en ecosistemas terrestres como en ambientes acuáticos (Lago de Atitlán). :contentReference[oaicite:4]{index=4}
        </p>
      </div>
      <nav class="nav">
        <a class="btn" href="index.html">Inicio</a>
        <a class="btn" href="1-1.html">Anterior (1.1)</a>
        <a class="btn primary" href="#" onclick="alert('Luego hacemos 1-3.html.'); return false;">Siguiente (1.3)</a>
      </nav>
    </header>

    <main class="stack">

      <!-- TEORÍA + CONTEXTO -->
      <section class="card">
        <h2>Conceptualización (técnica y contextualizada a Sololá)</h2>

        <div class="twoCols">
          <div class="theory">
            <p>
              Una <strong>cadena alimenticia</strong> describe la transferencia de <strong>energía</strong> y el movimiento de <strong>materia</strong>
              a través de <strong>niveles tróficos</strong>. En realidad, los ecosistemas suelen funcionar como <strong>redes tróficas</strong>
              (varias cadenas interconectadas). :contentReference[oaicite:5]{index=5}
            </p>
            <ul>
              <li><strong>Productores (autótrofos):</strong> plantas, algas y fitoplancton; elaboran alimento usando aire, suelo y energía solar. :contentReference[oaicite:6]{index=6}</li>
              <li><strong>Consumidores (heterótrofos):</strong> se alimentan de otros seres vivos; se organizan como primarios, secundarios, terciarios y cuaternarios. :contentReference[oaicite:7]{index=7}</li>
              <li><strong>Descomponedores:</strong> hongos, bacterias, lombrices y otros; reciclan materia orgánica y devuelven nutrientes, cerrando el ciclo. :contentReference[oaicite:8]{index=8}</li>
            </ul>
            <div class="callout">
              <strong>Principio:</strong> la energía fluye en una dirección (del productor hacia niveles superiores) y se va reduciendo en cada transferencia;
              por eso los depredadores superiores dependen de que existan niveles inferiores estables.
            </div>
          </div>

          <div class="theory">
            <p>
              <strong>Sololá / cuenca del Lago de Atitlán:</strong> el libro describe cadenas acuáticas en arroyos, ríos y lagos como el Lago de Atitlán,
              donde productores (algas, plantas acuáticas, fitoplancton) sostienen consumidores (peces y otros organismos), y las bacterias descomponen. :contentReference[oaicite:9]{index=9}
            </p>
            <ul>
              <li><strong>Terrestre (referencia del libro):</strong> orugas → sapos/ranas → serpientes → gavilanes. :contentReference[oaicite:10]{index=10}</li>
              <li><strong>Acuático (referencia del libro):</strong> algas/fitoplancton → peces pequeños → peces grandes → aves; descomposición por bacterias. :contentReference[oaicite:11]{index=11}</li>
            </ul>
            <div class="callout">
              <strong>Lectura aplicada:</strong> cuando cambia la disponibilidad/calidad de agua o nutrientes, se altera la productividad primaria y, en cascada,
              se afectan consumidores y servicios ecosistémicos locales.
            </div>
          </div>
        </div>
      </section>

      <!-- MAPA 1: MAPA CONCEPTUAL (MARKMAP) -->
      <section class="card">
        <h2>Mapa conceptual 1: conceptos clave (expandido)</h2>
        <p class="muted" style="margin:8px 0 0;">Este mapa aparece expandido por defecto. Puedes ajustar, reiniciar o verlo en pantalla completa.</p>

        <div class="mapWrap tall">
          <svg id="mmConcept" class="markmap"></svg>
          <div class="mapFallback" id="fbConcept">
            <div>
              <strong>No se pudo cargar el mapa conceptual.</strong><br>
              Recarga (Ctrl+F5). Los otros diagramas y el mini-juego siguen funcionando.
            </div>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="fitConcept">Ajustar</button>
          <button class="btn" id="resetConcept">Reiniciar</button>
          <button class="btn primary" id="fsConcept">Pantalla completa</button>
          <span class="pill">Expandido por defecto</span>
        </div>
      </section>

      <!-- MAPA 2: CADENA TERRESTRE (SVG INTERACTIVO) -->
      <section class="card">
        <h2>Diagrama 2: cadena trófica terrestre (flujo de energía)</h2>
        <p class="muted" style="margin:8px 0 0;">
          Haz clic en un nivel para resaltar el flujo de energía y leer su rol trófico. Basado en el ejemplo del libro. :contentReference[oaicite:12]{index=12}
        </p>

        <div class="chainWrap">
          <div class="chainHeader">
            <span class="pill">Energía: productor → consumidores → depredador superior</span>
            <span class="muted">Interacción: clic en nodos</span>
          </div>

          <div class="svgBox">
            <svg class="chainSvg" viewBox="0 0 1000 320" preserveAspectRatio="xMidYMid meet">
              <defs>
                <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(11,16,32,.65)"></path>
                </marker>
              </defs>

              <!-- Arrows -->
              <path id="tArrow1" class="arrow" d="M 150 160 L 330 160"></path>
              <path id="tArrow2" class="arrow" d="M 390 160 L 570 160"></path>
              <path id="tArrow3" class="arrow" d="M 630 160 L 810 160"></path>

              <!-- Nodes -->
              <g id="tNodeP" class="node" data-node="P" transform="translate(40,110)">
                <rect rx="18" ry="18" width="190" height="100"></rect>
                <text x="18" y="40">Productores</text>
                <text class="sub" x="18" y="66">Plantas</text>
              </g>

              <g id="tNodeC1" class="node" data-node="C1" transform="translate(280,110)">
                <rect rx="18" ry="18" width="190" height="100"></rect>
                <text x="18" y="40">Consumidor primario</text>
                <text class="sub" x="18" y="66">Orugas</text>
              </g>

              <g id="tNodeC2" class="node" data-node="C2" transform="translate(520,110)">
                <rect rx="18" ry="18" width="190" height="100"></rect>
                <text x="18" y="40">Consumidor secundario</text>
                <text class="sub" x="18" y="66">Sapos y ranas</text>
              </g>

              <g id="tNodeTop" class="node" data-node="TOP" transform="translate(760,110)">
                <rect rx="18" ry="18" width="200" height="100"></rect>
                <text x="18" y="40">Depredador superior</text>
                <text class="sub" x="18" y="66">Serpientes / Gavilanes</text>
              </g>
            </svg>
          </div>

          <div class="infoBox" id="tInfo">
            Selecciona un nodo para resaltar su flujo de energía y ver una explicación breve.
          </div>
        </div>

        <div class="row">
          <button class="btn" id="tReset">Reiniciar resaltado</button>
        </div>
      </section>

      <!-- MAPA 3: CADENA ACUÁTICA (SVG INTERACTIVO) -->
      <section class="card">
        <h2>Diagrama 3: cadena trófica acuática (Lago de Atitlán, flujo de energía)</h2>
        <p class="muted" style="margin:8px 0 0;">
          Basado en la descripción del libro para ambientes acuáticos (algas/fitoplancton → peces → peces grandes → aves) y descomposición por bacterias. :contentReference[oaicite:13]{index=13}
        </p>

        <div class="chainWrap">
          <div class="chainHeader">
            <span class="pill">Energía: productores acuáticos → consumidores → aves</span>
            <span class="muted">Interacción: clic en nodos</span>
          </div>

          <div class="svgBox">
            <svg class="chainSvg" viewBox="0 0 1000 320" preserveAspectRatio="xMidYMid meet">
              <defs>
                <marker id="arrowHead2" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(11,16,32,.65)"></path>
                </marker>
              </defs>

              <path id="aArrow1" class="arrow" d="M 165 160 L 330 160" marker-end="url(#arrowHead2)"></path>
              <path id="aArrow2" class="arrow" d="M 405 160 L 570 160" marker-end="url(#arrowHead2)"></path>
              <path id="aArrow3" class="arrow" d="M 645 160 L 810 160" marker-end="url(#arrowHead2)"></path>
              <path id="aArrow4" class="arrow" d="M 890 210 C 760 300, 280 300, 120 210" marker-end="url(#arrowHead2)"></path>

              <g id="aNodeP" class="node" data-node="P" transform="translate(40,110)">
                <rect rx="18" ry="18" width="210" height="100"></rect>
                <text x="18" y="40">Productores acuáticos</text>
                <text class="sub" x="18" y="66">Algas / fitoplancton</text>
              </g>

              <g id="aNodeC1" class="node" data-node="C1" transform="translate(300,110)">
                <rect rx="18" ry="18" width="210" height="100"></rect>
                <text x="18" y="40">Consumidores</text>
                <text class="sub" x="18" y="66">Organismos / peces pequeños</text>
              </g>

              <g id="aNodeC2" class="node" data-node="C2" transform="translate(560,110)">
                <rect rx="18" ry="18" width="210" height="100"></rect>
                <text x="18" y="40">Peces más grandes</text>
                <text class="sub" x="18" y="66">Depredación</text>
              </g>

              <g id="aNodeTop" class="node" data-node="TOP" transform="translate(820,110)">
                <rect rx="18" ry="18" width="160" height="100"></rect>
                <text x="18" y="40">Aves</text>
                <text class="sub" x="18" y="66">Consumen biota acuática</text>
              </g>

              <g id="aNodeD" class="node" data-node="D" transform="translate(390,230)">
                <rect rx="18" ry="18" width="240" height="70"></rect>
                <text x="18" y="42">Descomposición</text>
                <text class="sub" x="18" y="62">Bacterias reciclan nutrientes</text>
              </g>
            </svg>
          </div>

          <div class="infoBox" id="aInfo">
            Selecciona un nodo para resaltar el flujo de energía y ver una explicación breve.
          </div>
        </div>

        <div class="row">
          <button class="btn" id="aReset">Reiniciar resaltado</button>
        </div>
      </section>

      <!-- MINI-JUEGO (acorde al tema) -->
      <section class="card">
        <h2>Mini-juego / Evaluación: construye una cadena trófica correcta</h2>
        <p class="muted" style="margin:8px 0 0;">
          Arrastra (PC) o toca (celular) y coloca cada organismo en su <strong>nivel trófico</strong>. Incluye productores, consumidores y descomponedores. :contentReference[oaicite:14]{index=14} :contentReference[oaicite:15]{index=15} :contentReference[oaicite:16]{index=16}
        </p>

        <div class="gameGrid">
          <div class="bank">
            <h3>Banco de conceptos</h3>
            <div class="chips" id="bank"></div>

            <div class="row">
              <button class="btn primary" id="btnCheck">Evaluar</button>
              <button class="btn" id="btnClear">Reiniciar</button>
              <span class="badge" id="score">Resultado: 0/9</span>
            </div>

            <div class="result" id="feedback">
              Coloca todos los conceptos en un nivel y luego presiona <strong>Evaluar</strong>.
            </div>

            <div class="small">
              Modo celular: toca un chip para seleccionarlo y luego toca el nivel destino.
            </div>
          </div>

          <div class="slots" aria-label="Niveles tróficos">
            <div class="slot" data-slot="productor">
              <div class="slotHead">
                <strong>Productor</strong>
                <span>autótrofo</span>
              </div>
              <div class="chips" id="slot-productor"></div>
            </div>

            <div class="slot" data-slot="primario">
              <div class="slotHead">
                <strong>Consumidor primario</strong>
                <span>se alimenta de productores</span>
              </div>
              <div class="chips" id="slot-primario"></div>
            </div>

            <div class="slot" data-slot="secundario">
              <div class="slotHead">
                <strong>Consumidor secundario</strong>
                <span>se alimenta del primario</span>
              </div>
              <div class="chips" id="slot-secundario"></div>
            </div>

            <div class="slot" data-slot="terciario">
              <div class="slotHead">
                <strong>Consumidor terciario</strong>
                <span>se alimenta del secundario</span>
              </div>
              <div class="chips" id="slot-terciario"></div>
            </div>

            <div class="slot" data-slot="cuaternario">
              <div class="slotHead">
                <strong>Consumidor cuaternario</strong>
                <span>depredador superior</span>
              </div>
              <div class="chips" id="slot-cuaternario"></div>
            </div>

            <div class="slot" data-slot="descomponedor">
              <div class="slotHead">
                <strong>Descomponedor</strong>
                <span>reciclaje de nutrientes</span>
              </div>
              <div class="chips" id="slot-descomponedor"></div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- MODAL: CONCEPT MAP -->
  <div class="modal" id="modalConcept">
    <div class="modalBox" role="dialog" aria-modal="true" aria-label="Mapa conceptual en pantalla completa">
      <div class="modalTop">
        <strong>Mapa conceptual · 1.2</strong>
        <div class="row" style="margin:0;">
          <button class="btn" id="mFitConcept">Ajustar</button>
          <button class="btn" id="mResetConcept">Reiniciar</button>
          <button class="btn primary" id="mCloseConcept">Cerrar</button>
        </div>
      </div>
      <div class="modalMap">
        <svg id="mmConceptFull" class="markmap"></svg>
      </div>
    </div>
  </div>

  <script>
    // =========================================================
    // A) MINI-JUEGO (primero, robusto)
    // =========================================================
    const ITEMS = [
      { id: "plantas", label: "Plantas (productor)", correct: "productor" },
      { id: "algas", label: "Algas / fitoplancton (productor)", correct: "productor" },
      { id: "orugas", label: "Orugas", correct: "primario" },
      { id: "sapos", label: "Sapos y ranas", correct: "secundario" },
      { id: "serpientes", label: "Serpientes", correct: "terciario" },
      { id: "gavilanes", label: "Gavilanes", correct: "cuaternario" },
      { id: "peces", label: "Peces (consumidores)", correct: "secundario" }, // simplificación didáctica
      { id: "hongos", label: "Hongos", correct: "descomponedor" },
      { id: "bacterias", label: "Bacterias", correct: "descomponedor" }
    ];

    const bank = document.getElementById('bank');
    const scoreEl = document.getElementById('score');
    const feedback = document.getElementById('feedback');

    const slotEls = {
      productor: document.getElementById('slot-productor'),
      primario: document.getElementById('slot-primario'),
      secundario: document.getElementById('slot-secundario'),
      terciario: document.getElementById('slot-terciario'),
      cuaternario: document.getElementById('slot-cuaternario'),
      descomponedor: document.getElementById('slot-descomponedor')
    };

    let selectedId = null;

    function makeChip(item){
      const el = document.createElement('div');
      el.className = 'chip';
      el.textContent = item.label;
      el.draggable = true;
      el.dataset.id = item.id;

      el.addEventListener('dragstart', (e) => {
        try{
          e.dataTransfer.setData('text/plain', item.id);
          e.dataTransfer.effectAllowed = 'move';
        }catch(_){}
      });

      el.addEventListener('click', () => {
        document.querySelectorAll('.chip.selected').forEach(x => x.classList.remove('selected'));
        el.classList.add('selected');
        selectedId = item.id;
      });

      return el;
    }

    function moveChipTo(targetSlot, id){
      const chip = document.querySelector(`.chip[data-id="${id}"]`);
      if (!chip) return;
      chip.classList.remove('selected');
      selectedId = null;

      if (targetSlot === 'bank') bank.appendChild(chip);
      else slotEls[targetSlot].appendChild(chip);
    }

    function allowDropOnSlot(slotContainer, slotName){
      const slotBox = slotContainer.closest('.slot');

      slotBox.addEventListener('dragover', (e) => {
        e.preventDefault();
        slotBox.classList.add('dragover');
      });
      slotBox.addEventListener('dragleave', () => slotBox.classList.remove('dragover'));
      slotBox.addEventListener('drop', (e) => {
        e.preventDefault();
        slotBox.classList.remove('dragover');
        const id = e.dataTransfer.getData('text/plain');
        if (!id) return;
        moveChipTo(slotName, id);
      });

      // modo celular: tocar el slot coloca el seleccionado
      slotBox.addEventListener('click', () => {
        if (!selectedId) return;
        moveChipTo(slotName, selectedId);
      });
    }

    Object.entries(slotEls).forEach(([name, el]) => allowDropOnSlot(el, name));

    function whereIs(id){
      for (const [slot, el] of Object.entries(slotEls)){
        if (el.querySelector(`.chip[data-id="${id}"]`)) return slot;
      }
      if (bank.querySelector(`.chip[data-id="${id}"]`)) return 'bank';
      return 'bank';
    }

    function resetGame(){
      selectedId = null;
      bank.innerHTML = '';
      Object.values(slotEls).forEach(el => el.innerHTML = '');
      ITEMS.forEach(it => bank.appendChild(makeChip(it)));
      scoreEl.textContent = `Resultado: 0/${ITEMS.length}`;
      feedback.className = 'result';
      feedback.textContent = 'Coloca todos los conceptos en niveles y presiona Evaluar.';
    }

    function evaluate(){
      let correct = 0, unplaced = 0;

      ITEMS.forEach(it => {
        const pos = whereIs(it.id);
        if (pos === 'bank') unplaced++;
        if (pos === it.correct) correct++;
      });

      scoreEl.textContent = `Resultado: ${correct}/${ITEMS.length}`;

      if (unplaced > 0){
        feedback.className = 'result no';
        feedback.innerHTML = `Te faltan <strong>${unplaced}</strong> por colocar.`;
        return;
      }

      if (correct === ITEMS.length){
        feedback.className = 'result ok';
        feedback.innerHTML =
          `<strong>Excelente.</strong> Ahora explica: ¿por qué los descomponedores son indispensables para que continúe la cadena? :contentReference[oaicite:17]{index=17}`;
      } else {
        feedback.className = 'result no';
        feedback.innerHTML =
          `Vas bien: <strong>${correct}/${ITEMS.length}</strong>. Ajusta los niveles y vuelve a evaluar.`;
      }
    }

    document.getElementById('btnClear').addEventListener('click', resetGame);
    document.getElementById('btnCheck').addEventListener('click', evaluate);

    resetGame();

    // =========================================================
    // B) MAPA CONCEPTUAL (MARKMAP) - SIEMPRE EXPANDIDO
    // =========================================================
    const mdConcept = `
# 1.2 Cadenas alimenticias o tróficas
## Definición
- Representan cómo los elementos bióticos dependen entre sí
- Ayudan a comprender la naturaleza y proteger biodiversidad
- En la práctica: redes tróficas (varias cadenas conectadas)
## Componentes
### Productores (autótrofos)
- Plantas, algas, fitoplancton
- Elaboran alimento con aire, suelo y energía solar
### Consumidores (heterótrofos)
- Organismos que se alimentan de otros seres vivos
- Niveles:
  - Primarios (ej.: orugas)
  - Secundarios (ej.: sapos y ranas)
  - Terciarios (ej.: serpientes)
  - Cuaternarios (ej.: gavilanes)
### Descomponedores
- Hongos y bacterias (y otros)
- Reciclan materia orgánica y devuelven nutrientes
## Contexto Sololá / Lago de Atitlán
- Terrestre: orugas → sapos/ranas → serpientes → gavilanes
- Acuático: algas/fitoplancton → peces → peces grandes → aves
- Bacterias descomponen y reinician el ciclo
`.trim();

    let mmConcept = null;
    let mmConceptFull = null;

    function buildMap(targetId, md){
      const { Transformer, Markmap } = window.markmap;
      const transformer = new Transformer();
      const { root } = transformer.transform(md);
      const svg = document.getElementById(targetId);
      while (svg.firstChild) svg.removeChild(svg.firstChild);
      return Markmap.create(svg, { autoFit: true, duration: 250 }, root);
    }

    function safeRenderConcept(){
      const fallback = document.getElementById('fbConcept');
      try{
        if (!window.markmap || !window.markmap.Transformer || !window.markmap.Markmap) return false;
        mmConcept = buildMap('mmConcept', mdConcept);
        // SIEMPRE expandido:
        mmConcept.unfoldAll();
        mmConcept.fit();
        fallback.classList.remove('show');
        return true;
      }catch(e){
        fallback.classList.add('show');
        return true;
      }
    }

    // Render con reintentos por CDN lento
    let tries = 0;
    const timer = setInterval(() => {
      tries++;
      const done = safeRenderConcept();
      if (done || tries >= 12){
        clearInterval(timer);
        if (!mmConcept) document.getElementById('fbConcept').classList.add('show');
      }
    }, 350);

    document.getElementById('fitConcept').addEventListener('click', () => mmConcept && mmConcept.fit());
    document.getElementById('resetConcept').addEventListener('click', () => {
      mmConcept = null;
      safeRenderConcept();
    });

    // Fullscreen concept map
    const modalConcept = document.getElementById('modalConcept');
    document.getElementById('fsConcept').addEventListener('click', () => {
      modalConcept.classList.add('open');
      setTimeout(() => {
        try{
          mmConceptFull = buildMap('mmConceptFull', mdConcept);
          mmConceptFull.unfoldAll();
          mmConceptFull.fit();
        }catch(_){}
      }, 0);
    });
    document.getElementById('mCloseConcept').addEventListener('click', () => modalConcept.classList.remove('open'));
    modalConcept.addEventListener('click', (e) => { if (e.target === modalConcept) modalConcept.classList.remove('open'); });

    document.getElementById('mFitConcept').addEventListener('click', () => mmConceptFull && mmConceptFull.fit());
    document.getElementById('mResetConcept').addEventListener('click', () => {
      try{
        mmConceptFull = buildMap('mmConceptFull', mdConcept);
        mmConceptFull.unfoldAll();
        mmConceptFull.fit();
      }catch(_){}
    });

    // =========================================================
    // C) CADENAS TRÓFICAS INTERACTIVAS (SVG) - flujo de energía
    // =========================================================
    function setActiveTerrestrial(node){
      const nodes = ['tNodeP','tNodeC1','tNodeC2','tNodeTop'].map(id => document.getElementById(id));
      const arrows = ['tArrow1','tArrow2','tArrow3'].map(id => document.getElementById(id));

      nodes.forEach(n => n.classList.remove('active'));
      arrows.forEach(a => a.classList.remove('active'));

      // Dim all arrows
      arrows.forEach(a => a.classList.add('dim'));

      const info = document.getElementById('tInfo');
      const explain = {
        P: "Productores: base energética. Transforman energía solar en biomasa (materia orgánica).",
        C1: "Consumidor primario: se alimenta de productores (ej.: orugas).",
        C2: "Consumidor secundario: depreda o consume al consumidor primario (ej.: sapos y ranas).",
        TOP:"Consumidores superiores: depredadores que se alimentan de niveles previos (ej.: serpientes y gavilanes)."
      };

      if (!node){
        arrows.forEach(a => a.classList.remove('dim'));
        info.textContent = "Selecciona un nodo para resaltar su flujo de energía y ver una explicación breve.";
        return;
      }

      const mapNodeId = { P:'tNodeP', C1:'tNodeC1', C2:'tNodeC2', TOP:'tNodeTop' };
      document.getElementById(mapNodeId[node]).classList.add('active');

      // Highlight arrows up to that node
      const order = ['P','C1','C2','TOP'];
      const idx = order.indexOf(node);
      arrows.forEach(a => a.classList.add('dim'));
      for (let i=0;i<idx;i++){
        arrows[i].classList.remove('dim');
        arrows[i].classList.add('active');
      }
      info.innerHTML = `<strong>${explain[node]}</strong>`;

      // If producer selected, show first arrow only as active? keep consistent:
      if (node === 'P'){
        arrows.forEach(a => a.classList.add('dim'));
        arrows[0].classList.remove('dim');
        arrows[0].classList.add('active');
      }
    }

    document.getElementById('tNodeP').addEventListener('click', () => setActiveTerrestrial('P'));
    document.getElementById('tNodeC1').addEventListener('click', () => setActiveTerrestrial('C1'));
    document.getElementById('tNodeC2').addEventListener('click', () => setActiveTerrestrial('C2'));
    document.getElementById('tNodeTop').addEventListener('click', () => setActiveTerrestrial('TOP'));
    document.getElementById('tReset').addEventListener('click', () => setActiveTerrestrial(null));
    setActiveTerrestrial(null);

    function setActiveAquatic(node){
      const nodes = ['aNodeP','aNodeC1','aNodeC2','aNodeTop','aNodeD'].map(id => document.getElementById(id));
      const arrows = ['aArrow1','aArrow2','aArrow3','aArrow4'].map(id => document.getElementById(id));

      nodes.forEach(n => n.classList.remove('active'));
      arrows.forEach(a => { a.classList.remove('active'); a.classList.add('dim'); });

      const info = document.getElementById('aInfo');
      const explain = {
        P: "Productores acuáticos (algas/fitoplancton): convierten energía solar en biomasa; base del sistema acuático.",
        C1: "Consumidores (organismos/peces pequeños): se alimentan de productores o de plancton.",
        C2: "Peces más grandes: depredan consumidores menores, concentrando energía en niveles superiores.",
        TOP:"Aves: pueden consumir organismos acuáticos; conectan el sistema acuático con el terrestre.",
        D: "Descomposición (bacterias): recicla materia orgánica y libera nutrientes que sostienen nuevamente a los productores."
      };

      if (!node){
        arrows.forEach(a => a.classList.remove('dim'));
        info.textContent = "Selecciona un nodo para resaltar el flujo de energía y ver una explicación breve.";
        return;
      }

      const mapNodeId = { P:'aNodeP', C1:'aNodeC1', C2:'aNodeC2', TOP:'aNodeTop', D:'aNodeD' };
      document.getElementById(mapNodeId[node]).classList.add('active');

      // highlight path; D highlights recycling arrow
      if (node === 'D'){
        arrows.forEach(a => a.classList.add('dim'));
        arrows[3].classList.remove('dim');
        arrows[3].classList.add('active');
      } else {
        const order = ['P','C1','C2','TOP'];
        const idx = order.indexOf(node);
        arrows.forEach(a => a.classList.add('dim'));
        for (let i=0;i<idx;i++){
          arrows[i].classList.remove('dim');
          arrows[i].classList.add('active');
        }
      }

      info.innerHTML = `<strong>${explain[node]}</strong>`;
    }

    document.getElementById('aNodeP').addEventListener('click', () => setActiveAquatic('P'));
    document.getElementById('aNodeC1').addEventListener('click', () => setActiveAquatic('C1'));
    document.getElementById('aNodeC2').addEventListener('click', () => setActiveAquatic('C2'));
    document.getElementById('aNodeTop').addEventListener('click', () => setActiveAquatic('TOP'));
    document.getElementById('aNodeD').addEventListener('click', () => setActiveAquatic('D'));
    document.getElementById('aReset').addEventListener('click', () => setActiveAquatic(null));
    setActiveAquatic(null);
  </script>
</body>
</html>
