<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√≥dulo 2 ¬∑ 2.2 Bienes y servicios del bosque</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Markmap -->
  <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.16.1"></script>

  <style>
    :root{
      --ink:#0b1020;
      --muted:rgba(11,16,32,.72);
      --glass:rgba(255,255,255,.66);
      --stroke:rgba(11,16,32,.10);
      --shadow:0 18px 45px rgba(11,16,32,.16);
      --shadow-soft:0 10px 24px rgba(11,16,32,.12);
      --radius:24px;

      --good: rgba(30, 160, 90, .20);
      --bad: rgba(210, 70, 100, .18);
      --info: rgba(45, 160, 220, .18);
      --warn: rgba(245, 158, 11, .18);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 760px at 12% 12%, rgba(210, 255, 220, .84), transparent 58%),
        radial-gradient(980px 760px at 84% 18%, rgba(175, 235, 255, .84), transparent 62%),
        radial-gradient(1200px 920px at 48% 96%, rgba(255, 215, 240, .70), transparent 58%),
        linear-gradient(135deg, #effff4 0%, #e8f6ff 45%, #fff0f7 100%);
      min-height:100vh;
    }
    .wrap{ max-width:1200px; margin:0 auto; padding:26px 18px 64px; }

    header{
      border:1px solid var(--stroke);
      background: var(--glass);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(12px);
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }
    .kicker{ font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.3px; }
    h1{
      margin:6px 0 0;
      font-family: Outfit, Inter, system-ui;
      font-weight:800;
      font-size: clamp(20px, 2.5vw, 28px);
      line-height:1.15;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
      max-width: 85ch;
    }
    .nav{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.62);
      color: rgba(11,16,32,.92);
      font-weight:800;
      text-decoration:none;
      font-size:13px;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      cursor:pointer;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.80); border-color: rgba(11,16,32,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(210,255,220,.88), rgba(175,235,255,.88), rgba(255,215,240,.80));
    }

    .stack{ margin-top:14px; display:grid; gap:14px; }
    .card{
      border:1px solid var(--stroke);
      background: var(--glass);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      padding:16px;
    }
    h2{
      margin:0;
      font-family: Outfit, Inter, system-ui;
      font-weight:800;
      font-size:16px;
      letter-spacing:.2px;
    }
    .muted{ color: var(--muted); }

    .twoCols{ margin-top:10px; display:grid; grid-template-columns: 1.05fr .95fr; gap:12px; }
    @media (max-width: 980px){ .twoCols{ grid-template-columns: 1fr; } }
    .box{
      border-radius: 18px;
      border: 1px solid rgba(11,16,32,.10);
      background: rgba(255,255,255,.58);
      padding: 12px;
      box-shadow: var(--shadow-soft);
      line-height:1.55;
      font-size: 13px;
      color: rgba(11,16,32,.86);
    }
    ul{ margin: 8px 0 0 18px; padding:0; }
    li{ margin: 6px 0; }

    /* Map */
    .mapTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .mapBtns{ display:flex; gap:10px; flex-wrap:wrap; }
    .mapStage{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px dashed rgba(11,16,32,.22);
      background:
        radial-gradient(circle at 1px 1px, rgba(11,16,32,.08) 1px, transparent 1px) 0 0 / 22px 22px,
        linear-gradient(180deg, rgba(255,255,255,.56), rgba(255,255,255,.40));
      padding: 10px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
      position: relative;
      overflow:hidden;
    }
    svg.markmap{ width:100%; height: 420px; display:block; }
    .mapFallback{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding: 16px;
      text-align:center;
      color: rgba(11,16,32,.72);
      background: rgba(255,255,255,.74);
      opacity:0;
      pointer-events:none;
      transition: opacity .15s ease;
    }
    .mapFallback.show{ opacity:1; pointer-events:auto; }

    /* Memory game */
    .gameGrid{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .hud{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 10px;
    }
    .chipHud{
      border-radius: 999px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.62);
      padding: 6px 10px;
      font-weight: 800;
      font-size: 12px;
      color: rgba(11,16,32,.78);
    }
    .board{
      margin-top: 10px;
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }
    @media (max-width: 1100px){ .board{ grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 700px){ .board{ grid-template-columns: repeat(3, 1fr); } }

    .tile{
      position:relative;
      border-radius: 16px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.58);
      box-shadow: var(--shadow-soft);
      padding: 10px;
      min-height: 92px;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      transform: translateZ(0);
    }
    .tileInner{
      transition: transform .18s ease, opacity .18s ease;
    }
    .tile .front{
      font-family: Outfit, Inter, system-ui;
      font-weight: 800;
      font-size: 14px;
      color: rgba(11,16,32,.90);
    }
    .tile .back{
      opacity:0;
      transform: translateY(6px);
      font-size: 12.5px;
      line-height: 1.35;
      color: rgba(11,16,32,.80);
      margin-top: 6px;
      font-weight: 700;
    }
    .tile.revealed .back{ opacity:1; transform: translateY(0); }
    .tile.revealed .front{ opacity:.55; }

    .tile.matched{
      background: rgba(30,160,90,.10);
      border-color: rgba(34,197,94,.26);
      cursor: default;
    }

    .result{
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(11,16,32,.12);
      background: rgba(255,255,255,.55);
      padding: 12px;
      font-size: 13px;
      line-height: 1.55;
      color: rgba(11,16,32,.82);
    }
    .ok{ background: var(--good); border-color: rgba(34,197,94,.28); }
    .no{ background: var(--bad); border-color: rgba(225,29,72,.26); }
    .info{ background: var(--info); border-color: rgba(45,160,220,.25); }
    .warn{ background: var(--warn); border-color: rgba(245,158,11,.26); }

    footer{ text-align:center; padding:18px 0 4px; color: rgba(11,16,32,.58); font-size: 13px; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="kicker">M√≥dulo 2 ¬∑ El bosque</div>
        <h1>2.2 Bienes y servicios ambientales del bosque</h1>
        <p class="subtitle">
          El bosque nos da <strong>bienes</strong> (cosas que usamos) y <strong>servicios</strong> (beneficios que sostienen la vida).
          Hoy aprender√°s a reconocerlos con un juego de memoria.
        </p>
      </div>
      <nav class="nav">
        <a class="btn" href="index.html">Inicio</a>
        <a class="btn" href="2-1.html">Anterior (2.1)</a>
        <a class="btn primary" href="2-3.html">Siguiente (2.3)</a>
      </nav>
    </header>

    <main class="stack">
      <section class="card">
        <h2>Contexto te√≥rico (ampliado)</h2>
        <div class="twoCols">
          <div class="box">
            <p>
              Los <strong>bienes</strong> son productos que obtenemos del bosque. Los <strong>servicios ambientales</strong> son beneficios
              que el bosque brinda sin que siempre los veamos (como regular el agua o proteger el suelo).
            </p>
            <ul>
              <li><strong>Provisi√≥n:</strong> madera, le√±a, alimentos, plantas medicinales, agua (por recarga h√≠drica).</li>
              <li><strong>Regulaci√≥n:</strong> reduce erosi√≥n, regula temperatura y humedad, ayuda a mantener calidad del agua.</li>
              <li><strong>Soporte:</strong> h√°bitat, formaci√≥n de suelo, ciclo de nutrientes, polinizaci√≥n.</li>
              <li><strong>Culturales:</strong> paisaje, turismo, recreaci√≥n, identidad local, educaci√≥n.</li>
            </ul>
          </div>

          <div class="box">
            <p><strong>Idea clave</strong>:</p>
            <div class="result info">
              Cuando se degrada un bosque, no solo se pierden √°rboles: tambi√©n se pierden servicios como agua, suelos estables y biodiversidad.
            </div>
            <p style="margin-top:10px;"><strong>Ejemplo cuenca</strong>:</p>
            <ul>
              <li>M√°s deforestaci√≥n ‚Üí m√°s erosi√≥n ‚Üí m√°s sedimentos en r√≠os ‚Üí peor calidad de agua.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="mapTop">
          <div>
            <h2 style="margin:0;">Mapa mental</h2>
            <div class="muted">Bienes y servicios del bosque (4 categor√≠as).</div>
          </div>
          <div class="mapBtns">
            <button class="btn" id="btnFit" type="button">Ajustar</button>
            <button class="btn" id="btnToggle" type="button">Expandir/Contraer</button>
            <button class="btn" id="btnResetMap" type="button">Reiniciar</button>
          </div>
        </div>

        <div class="mapStage">
          <svg id="mindmap" class="markmap"></svg>
          <div class="mapFallback" id="mapFallback">
            <div><strong>No se pudo cargar el mapa mental.</strong><br>Recarga la p√°gina o revisa la conexi√≥n.</div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Juego: Memoria del bosque</h2>
        <p class="muted" style="margin:8px 0 0;">
          Encuentra las parejas (categor√≠a ‚Üî ejemplo). Ganas cuando completas todas.
        </p>

        <div class="gameGrid">
          <div class="box">
            <div class="hud">
              <div class="chipHud">Movimientos: <span id="moves">0</span></div>
              <div class="chipHud">Parejas: <span id="pairs">0</span> / <span id="pairsTotal">6</span></div>
              <button class="btn" id="btnShuffle" type="button">Mezclar</button>
              <button class="btn" id="btnReset" type="button">Reiniciar</button>
            </div>

            <div class="board" id="board"></div>

            <div class="result" id="result" style="display:none;"></div>
          </div>
        </div>
      </section>

      <footer>EPC AALA</footer>
    </main>
  </div>

  <script>
    // =========================
    // MAPA MENTAL (robusto)
    // =========================
    const md = `
# 2.2 Bienes y servicios del bosque
## Bienes (provisi√≥n)
- Madera y le√±a
- Alimentos (frutos, hongos)
- Plantas medicinales
## Servicios de regulaci√≥n
- Control de erosi√≥n
- Regulaci√≥n de temperatura/humedad
- Mejora calidad del agua
## Servicios de soporte
- H√°bitat para especies
- Formaci√≥n de suelo
- Ciclo de nutrientes
## Servicios culturales
- Paisaje y turismo
- Recreaci√≥n
- Educaci√≥n e identidad
`.trim();

    let mm = null, expanded = true;
    function safeRenderMap(){
      const fallback = document.getElementById('mapFallback');
      try{
        if (!window.markmap || !window.markmap.Transformer || !window.markmap.Markmap) return false;
        const { Transformer, Markmap } = window.markmap;
        const transformer = new Transformer();
        const { root } = transformer.transform(md);

        const svg = document.getElementById('mindmap');
        while (svg.firstChild) svg.removeChild(svg.firstChild);

        mm = Markmap.create(svg, { autoFit:true, duration:240 }, root);
        expanded = true;
        fallback.classList.remove('show');
        return true;
      }catch(e){
        fallback.classList.add('show');
        return true;
      }
    }
    let tries=0;
    const t=setInterval(()=>{
      tries++;
      const ok=safeRenderMap();
      if(ok || tries>=12){
        clearInterval(t);
        if(!mm) document.getElementById('mapFallback').classList.add('show');
      }
    }, 300);

    document.getElementById('btnFit').addEventListener('click', () => mm && mm.fit());
    document.getElementById('btnToggle').addEventListener('click', () => {
      if(!mm) return;
      if(expanded) mm.foldAll(); else mm.unfoldAll();
      expanded=!expanded;
    });
    document.getElementById('btnResetMap').addEventListener('click', () => { mm=null; expanded=true; safeRenderMap(); });

    // =========================
    // JUEGO: Memoria (parejas)
    // =========================
    const PAIRS = [
      { k:"Provisi√≥n", v:"Madera y le√±a" },
      { k:"Provisi√≥n", v:"Plantas medicinales" },
      { k:"Regulaci√≥n", v:"Control de erosi√≥n" },
      { k:"Regulaci√≥n", v:"Mejora calidad del agua" },
      { k:"Soporte", v:"H√°bitat para especies" },
      { k:"Culturales", v:"Turismo y recreaci√≥n" },
    ];

    const boardEl = document.getElementById('board');
    const movesEl = document.getElementById('moves');
    const pairsEl = document.getElementById('pairs');
    const pairsTotalEl = document.getElementById('pairsTotal');
    const resultEl = document.getElementById('result');

    pairsTotalEl.textContent = String(PAIRS.length);

    let tiles = [];
    let open = [];
    let locked = false;
    let moves = 0;
    let matched = 0;

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function buildTiles(){
      // 2 tiles per pair: one category, one example; share same id
      let raw = [];
      PAIRS.forEach((p, i) => {
        raw.push({ id:"p"+i, type:"k", text:p.k });
        raw.push({ id:"p"+i, type:"v", text:p.v });
      });
      tiles = shuffle(raw);
    }

    function render(){
      boardEl.innerHTML = '';
      tiles.forEach((t, idx) => {
        const div = document.createElement('div');
        div.className = 'tile';
        div.dataset.idx = String(idx);
        div.innerHTML = `
          <div class="tileInner">
            <div class="front">üåø Carta</div>
            <div class="back">${t.text}</div>
          </div>
        `;
        div.addEventListener('click', () => flip(idx));
        boardEl.appendChild(div);
      });
    }

    function setHud(){
      movesEl.textContent = String(moves);
      pairsEl.textContent = String(matched);
    }

    function flip(i){
      if(locked) return;
      const t = tiles[i];
      const el = boardEl.querySelector(`.tile[data-idx="${i}"]`);
      if(!el || el.classList.contains('matched') || el.classList.contains('revealed')) return;

      el.classList.add('revealed');
      open.push({ i, id:t.id });

      if(open.length === 2){
        moves += 1;
        setHud();
        const [a,b] = open;
        if(a.id === b.id){
          // match
          const ea = boardEl.querySelector(`.tile[data-idx="${a.i}"]`);
          const eb = boardEl.querySelector(`.tile[data-idx="${b.i}"]`);
          ea.classList.add('matched');
          eb.classList.add('matched');
          open = [];
          matched += 1;
          setHud();

          if(matched === PAIRS.length){
            resultEl.style.display = 'block';
            resultEl.className = 'result ok';
            resultEl.innerHTML = `<strong>¬°Excelente!</strong> Completaste todas las parejas en <strong>${moves}</strong> movimientos.`;
          }
        } else {
          // hide after moment
          locked = true;
          setTimeout(() => {
            const ea = boardEl.querySelector(`.tile[data-idx="${a.i}"]`);
            const eb = boardEl.querySelector(`.tile[data-idx="${b.i}"]`);
            if(ea) ea.classList.remove('revealed');
            if(eb) eb.classList.remove('revealed');
            open = [];
            locked = false;
          }, 650);
        }
      }
    }

    function resetGame(){
      moves = 0;
      matched = 0;
      open = [];
      locked = false;
      resultEl.style.display = 'none';
      resultEl.className = 'result';
      buildTiles();
      render();
      setHud();
    }

    document.getElementById('btnShuffle').addEventListener('click', resetGame);
    document.getElementById('btnReset').addEventListener('click', resetGame);

    resetGame();
  </script>
</body>
</html>
